<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue Claude Plugin with History</title>
    <!-- å¼•å…¥ Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- å¼•å…¥ Axios ç”¨äº API è°ƒç”¨ -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC',
                       'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f5f5;
            height: 100vh;
            overflow: hidden;
        }

        #app {
            width: 100%;
            height: 100vh;
            display: flex;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        /* ä¾§è¾¹æ æ ·å¼ */
        .sidebar {
            width: 250px;
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar h2 {
            font-size: 18px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .history-controls {
            margin-bottom: 20px;
        }

        .history-controls button {
            width: 100%;
            margin-bottom: 8px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .history-controls button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .search-box {
            width: 100%;
            padding: 8px;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: white;
            font-size: 12px;
        }

        .search-box::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .history-list {
            max-height: calc(100vh - 300px);
            overflow-y: auto;
        }

        .history-item {
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .history-item.active {
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .history-item-title {
            font-weight: bold;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .history-item-preview {
            opacity: 0.8;
            font-size: 11px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .history-item-date {
            opacity: 0.6;
            font-size: 10px;
            margin-top: 5px;
        }

        /* ä¸»å†…å®¹åŒºæ ·å¼ */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow: hidden;
        }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        h1 {
            font-size: 32px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .claude-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .api-key-section {
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
        }

        .input-group {
            margin-bottom: 12px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 13px;
            opacity: 0.9;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 8px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }

        .input-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .button {
            padding: 10px 20px;
            font-size: 14px;
            background: white;
            color: #764ba2;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            margin: 5px;
        }

        .button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .button.secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .button.danger {
            background: rgba(255, 100, 100, 0.3);
            color: white;
        }

        .response-section {
            flex: 1;
            margin-top: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            overflow-y: auto;
            max-height: calc(100vh - 400px);
        }

        .response-section h3 {
            margin-bottom: 10px;
            font-size: 16px;
        }

        .conversation-stats {
            font-size: 11px;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .response-content {
            padding: 12px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border-radius: 6px;
            white-space: pre-wrap;
            font-size: 13px;
            margin-bottom: 10px;
        }

        .message-wrapper {
            margin-bottom: 12px;
            animation: slideIn 0.3s ease;
        }

        .message-role {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 12px;
        }

        .message-time {
            font-size: 10px;
            opacity: 0.6;
            margin-left: 10px;
        }

        .loading {
            text-align: center;
            padding: 15px;
        }

        .spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .error {
            padding: 8px;
            background: rgba(255, 0, 0, 0.2);
            border-radius: 6px;
            margin-top: 8px;
            font-size: 12px;
        }

        .success {
            padding: 8px;
            background: rgba(0, 255, 0, 0.2);
            border-radius: 6px;
            margin-top: 8px;
            font-size: 12px;
        }

        .vue-logo {
            width: 30px;
            height: 30px;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
            animation: rotate 20s linear infinite;
        }

        /* æ–‡ä»¶ä¸Šä¼ æ ·å¼ */
        .file-input {
            display: none;
        }

        .file-label {
            display: inline-block;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .file-label:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- å·¦ä¾§å†å²è®°å½•ä¾§è¾¹æ  -->
        <div class="sidebar">
            <h2>å¯¹è¯å†å²</h2>

            <!-- æœç´¢æ¡† -->
            <input
                type="text"
                class="search-box"
                v-model="searchQuery"
                placeholder="æœç´¢å†å²è®°å½•..."
                @input="filterHistory"
            >

            <!-- å†å²è®°å½•æ§åˆ¶æŒ‰é’® -->
            <div class="history-controls">
                <button @click="createNewSession">
                    â• æ–°å»ºå¯¹è¯
                </button>
                <button @click="exportAllHistory">
                    ğŸ“¥ å¯¼å‡ºæ‰€æœ‰å†å²
                </button>
                <label class="file-label">
                    ğŸ“¤ å¯¼å…¥å†å²
                    <input
                        type="file"
                        class="file-input"
                        accept=".json"
                        @change="importHistory"
                    >
                </label>
                <button @click="clearAllHistory" class="button danger">
                    ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰å†å²
                </button>
            </div>

            <!-- å†å²è®°å½•åˆ—è¡¨ -->
            <div class="history-list">
                <div
                    v-for="session in filteredSessions"
                    :key="session.id"
                    :class="['history-item', { active: currentSessionId === session.id }]"
                    @click="loadSession(session.id)"
                >
                    <div class="history-item-title">
                        {{ session.title || 'æœªå‘½åå¯¹è¯' }}
                    </div>
                    <div class="history-item-preview">
                        {{ session.preview }}
                    </div>
                    <div class="history-item-date">
                        {{ formatDate(session.timestamp) }}
                        <span style="float: right;">ğŸ’¬ {{ session.messageCount }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <div class="container">
                <!-- æ ‡é¢˜éƒ¨åˆ† -->
                <h1>
                    <svg class="vue-logo" viewBox="0 0 261.76 226.69" xmlns="http://www.w3.org/2000/svg">
                        <path d="m161.096.001-30.225 52.351L100.647.001H-.005l130.877 226.688L261.749.001z" fill="#41b883"/>
                        <path d="m161.096.001-30.225 52.351L100.647.001H52.346l78.526 136.01L209.398.001z" fill="#34495e"/>
                    </svg>
                    Vue + Claude å†å²è®°å½•ç‰ˆ
                </h1>

                <!-- Claude API é›†æˆéƒ¨åˆ† -->
                <div class="claude-section">
                    <!-- API Key é…ç½® -->
                    <div class="api-key-section">
                        <div class="input-group">
                            <label for="apiKey">Claude API Key (å¯é€‰):</label>
                            <input
                                type="password"
                                id="apiKey"
                                v-model="apiKey"
                                placeholder="sk-ant-api03-..."
                                @input="saveApiKey"
                            >
                        </div>
                        <div class="success" v-if="apiKeySaved">
                            API Key å·²ä¿å­˜
                        </div>
                    </div>

                    <!-- æ¶ˆæ¯è¾“å…¥åŒº -->
                    <div class="input-group">
                        <label for="userMessage">å‘ Claude æé—®:</label>
                        <textarea
                            id="userMessage"
                            v-model="userMessage"
                            placeholder="è¾“å…¥ä½ çš„é—®é¢˜..."
                            @keydown.enter.ctrl="sendMessage"
                        ></textarea>
                    </div>

                    <!-- æŒ‰é’®ç»„ -->
                    <div>
                        <button
                            class="button"
                            @click="sendMessage"
                            :disabled="loading || !userMessage.trim()"
                        >
                            å‘é€æ¶ˆæ¯
                        </button>
                        <button
                            class="button secondary"
                            @click="clearCurrentSession"
                            :disabled="loading"
                        >
                            æ¸…é™¤å½“å‰å¯¹è¯
                        </button>
                        <button
                            class="button secondary"
                            @click="exportCurrentSession"
                            :disabled="!conversation.length"
                        >
                            å¯¼å‡ºå½“å‰å¯¹è¯
                        </button>
                        <button
                            class="button secondary"
                            @click="renameSession"
                        >
                            é‡å‘½åå¯¹è¯
                        </button>
                    </div>

                    <!-- åŠ è½½çŠ¶æ€ -->
                    <div class="loading" v-if="loading">
                        <div class="spinner"></div>
                        <p>æ­£åœ¨ä¸ Claude é€šä¿¡...</p>
                    </div>

                    <!-- é”™è¯¯æç¤º -->
                    <div class="error" v-if="error">
                        {{ error }}
                    </div>

                    <!-- å“åº”æ˜¾ç¤ºåŒº -->
                    <div class="response-section" v-if="conversation.length > 0">
                        <h3>å½“å‰å¯¹è¯</h3>
                        <div class="conversation-stats">
                            å…± {{ conversation.length }} æ¡æ¶ˆæ¯ |
                            ä¼šè¯ID: {{ currentSessionId }} |
                            å¼€å§‹æ—¶é—´: {{ formatDate(currentSessionTimestamp) }}
                        </div>
                        <div v-for="(msg, index) in conversation" :key="index" class="message-wrapper">
                            <div class="message-role">
                                {{ msg.role === 'user' ? 'ğŸ‘¤ ä½ ' : 'ğŸ¤– Claude' }}:
                                <span class="message-time">{{ formatTime(msg.timestamp) }}</span>
                            </div>
                            <div class="response-content">{{ msg.content }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        // Claude API é…ç½®
        const PROXY_URL = 'https://api.anthropic.com/v1/messages';
        const STORAGE_KEY = 'claude_history';
        const API_KEY_STORAGE = 'claude_api_key';

        createApp({
            data() {
                return {
                    // API ç›¸å…³
                    apiKey: '',
                    apiKeySaved: false,

                    // å½“å‰å¯¹è¯
                    userMessage: '',
                    conversation: [],
                    loading: false,
                    error: null,

                    // ä¼šè¯ç®¡ç†
                    currentSessionId: null,
                    currentSessionTimestamp: null,
                    sessions: [],

                    // æœç´¢å’Œè¿‡æ»¤
                    searchQuery: '',
                    filteredSessions: []
                }
            },
            methods: {
                // ç”Ÿæˆå”¯ä¸€ID
                generateId() {
                    return Date.now().toString(36) + Math.random().toString(36).substr(2);
                },

                // æ ¼å¼åŒ–æ—¥æœŸ
                formatDate(timestamp) {
                    if (!timestamp) return '';
                    const date = new Date(timestamp);
                    return `${date.getMonth() + 1}/${date.getDate()} ${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
                },

                // æ ¼å¼åŒ–æ—¶é—´
                formatTime(timestamp) {
                    if (!timestamp) return '';
                    const date = new Date(timestamp);
                    return `${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}:${String(date.getSeconds()).padStart(2, '0')}`;
                },

                // åˆ›å»ºæ–°ä¼šè¯
                createNewSession() {
                    this.saveCurrentSession();
                    this.currentSessionId = this.generateId();
                    this.currentSessionTimestamp = Date.now();
                    this.conversation = [];
                    this.error = null;
                },

                // åŠ è½½ä¼šè¯
                loadSession(sessionId) {
                    this.saveCurrentSession();
                    const session = this.sessions.find(s => s.id === sessionId);
                    if (session) {
                        this.currentSessionId = session.id;
                        this.currentSessionTimestamp = session.timestamp;
                        this.conversation = session.messages || [];
                        this.error = null;
                    }
                },

                // ä¿å­˜å½“å‰ä¼šè¯
                saveCurrentSession() {
                    if (!this.currentSessionId || this.conversation.length === 0) return;

                    const sessionIndex = this.sessions.findIndex(s => s.id === this.currentSessionId);
                    const sessionData = {
                        id: this.currentSessionId,
                        timestamp: this.currentSessionTimestamp,
                        title: this.getSessionTitle(),
                        preview: this.getSessionPreview(),
                        messages: this.conversation,
                        messageCount: this.conversation.length
                    };

                    if (sessionIndex >= 0) {
                        this.sessions[sessionIndex] = sessionData;
                    } else {
                        this.sessions.unshift(sessionData);
                    }

                    this.saveToStorage();
                    this.filterHistory();
                },

                // è·å–ä¼šè¯æ ‡é¢˜
                getSessionTitle() {
                    if (this.conversation.length > 0) {
                        const firstUserMessage = this.conversation.find(m => m.role === 'user');
                        if (firstUserMessage) {
                            return firstUserMessage.content.substring(0, 30) + (firstUserMessage.content.length > 30 ? '...' : '');
                        }
                    }
                    return 'æ–°å¯¹è¯';
                },

                // è·å–ä¼šè¯é¢„è§ˆ
                getSessionPreview() {
                    if (this.conversation.length > 1) {
                        const lastMessage = this.conversation[this.conversation.length - 1];
                        return lastMessage.content.substring(0, 50) + (lastMessage.content.length > 50 ? '...' : '');
                    }
                    return 'æ— å†…å®¹';
                },

                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                saveToStorage() {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(this.sessions));
                },

                // ä»æœ¬åœ°å­˜å‚¨åŠ è½½
                loadFromStorage() {
                    const stored = localStorage.getItem(STORAGE_KEY);
                    if (stored) {
                        try {
                            this.sessions = JSON.parse(stored);
                            this.filteredSessions = [...this.sessions];
                        } catch (e) {
                            console.error('åŠ è½½å†å²è®°å½•å¤±è´¥:', e);
                        }
                    }
                },

                // æœç´¢å†å²
                filterHistory() {
                    if (!this.searchQuery) {
                        this.filteredSessions = [...this.sessions];
                        return;
                    }

                    const query = this.searchQuery.toLowerCase();
                    this.filteredSessions = this.sessions.filter(session => {
                        const titleMatch = session.title && session.title.toLowerCase().includes(query);
                        const messagesMatch = session.messages && session.messages.some(msg =>
                            msg.content.toLowerCase().includes(query)
                        );
                        return titleMatch || messagesMatch;
                    });
                },

                // å¯¼å‡ºå½“å‰ä¼šè¯
                exportCurrentSession() {
                    if (!this.conversation.length) return;

                    const sessionData = {
                        id: this.currentSessionId,
                        timestamp: this.currentSessionTimestamp,
                        title: this.getSessionTitle(),
                        messages: this.conversation,
                        exportDate: new Date().toISOString()
                    };

                    const blob = new Blob([JSON.stringify(sessionData, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `claude-session-${this.currentSessionId}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                },

                // å¯¼å‡ºæ‰€æœ‰å†å²
                exportAllHistory() {
                    const exportData = {
                        sessions: this.sessions,
                        exportDate: new Date().toISOString(),
                        totalSessions: this.sessions.length,
                        totalMessages: this.sessions.reduce((sum, s) => sum + (s.messageCount || 0), 0)
                    };

                    const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `claude-all-history-${Date.now()}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                },

                // å¯¼å…¥å†å²
                async importHistory(event) {
                    const file = event.target.files[0];
                    if (!file) return;

                    try {
                        const text = await file.text();
                        const data = JSON.parse(text);

                        if (data.sessions) {
                            // å¯¼å…¥å¤šä¸ªä¼šè¯
                            this.sessions = [...data.sessions, ...this.sessions];
                        } else if (data.messages) {
                            // å¯¼å…¥å•ä¸ªä¼šè¯
                            this.sessions.unshift(data);
                        }

                        this.saveToStorage();
                        this.filterHistory();
                        this.error = null;
                        alert('å†å²è®°å½•å¯¼å…¥æˆåŠŸï¼');
                    } catch (e) {
                        this.error = 'å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼é”™è¯¯';
                        console.error('å¯¼å…¥å¤±è´¥:', e);
                    }

                    // æ¸…é™¤æ–‡ä»¶è¾“å…¥
                    event.target.value = '';
                },

                // æ¸…é™¤æ‰€æœ‰å†å²
                clearAllHistory() {
                    if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                        this.sessions = [];
                        this.filteredSessions = [];
                        this.conversation = [];
                        this.currentSessionId = null;
                        this.currentSessionTimestamp = null;
                        localStorage.removeItem(STORAGE_KEY);
                        this.createNewSession();
                    }
                },

                // æ¸…é™¤å½“å‰ä¼šè¯
                clearCurrentSession() {
                    this.conversation = [];
                    this.userMessage = '';
                    this.error = null;
                },

                // é‡å‘½åä¼šè¯
                renameSession() {
                    if (!this.currentSessionId) return;

                    const newTitle = prompt('è¯·è¾“å…¥æ–°çš„ä¼šè¯æ ‡é¢˜:', this.getSessionTitle());
                    if (newTitle) {
                        const session = this.sessions.find(s => s.id === this.currentSessionId);
                        if (session) {
                            session.title = newTitle;
                            this.saveToStorage();
                            this.filterHistory();
                        }
                    }
                },

                // ä¿å­˜ API Key
                saveApiKey() {
                    if (this.apiKey) {
                        localStorage.setItem(API_KEY_STORAGE, this.apiKey);
                        this.apiKeySaved = true;
                        setTimeout(() => {
                            this.apiKeySaved = false;
                        }, 2000);
                    }
                },

                // å‘é€æ¶ˆæ¯åˆ° Claude
                async sendMessage() {
                    if (!this.userMessage.trim()) return;

                    // ç¡®ä¿æœ‰å½“å‰ä¼šè¯
                    if (!this.currentSessionId) {
                        this.createNewSession();
                    }

                    this.loading = true;
                    this.error = null;

                    const messageTimestamp = Date.now();

                    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°å¯¹è¯
                    this.conversation.push({
                        role: 'user',
                        content: this.userMessage,
                        timestamp: messageTimestamp
                    });

                    try {
                        const response = await this.callClaudeAPI(this.userMessage);

                        if (response) {
                            this.conversation.push({
                                role: 'assistant',
                                content: response,
                                timestamp: Date.now()
                            });
                        }

                        // ä¿å­˜ä¼šè¯
                        this.saveCurrentSession();

                        // æ¸…ç©ºè¾“å…¥æ¡†
                        this.userMessage = '';
                    } catch (err) {
                        this.error = 'å‘é€å¤±è´¥ï¼š' + err.message;
                        // ç§»é™¤å¤±è´¥çš„ç”¨æˆ·æ¶ˆæ¯
                        this.conversation.pop();
                    } finally {
                        this.loading = false;
                    }
                },

                // è°ƒç”¨ Claude API
                async callClaudeAPI(message) {
                    const apiKey = this.apiKey || localStorage.getItem(API_KEY_STORAGE);

                    // å¦‚æœæ²¡æœ‰ API Keyï¼Œä½¿ç”¨æ¨¡æ‹Ÿå“åº”
                    if (!apiKey) {
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        return this.getMockResponse(message);
                    }

                    try {
                        const response = await axios.post(
                            PROXY_URL,
                            {
                                model: 'claude-3-sonnet-20240229',
                                max_tokens: 1024,
                                messages: this.conversation.map(msg => ({
                                    role: msg.role,
                                    content: msg.content
                                }))
                            },
                            {
                                headers: {
                                    'Content-Type': 'application/json',
                                    'x-api-key': apiKey,
                                    'anthropic-version': '2023-06-01'
                                }
                            }
                        );

                        if (response.data && response.data.content && response.data.content[0]) {
                            return response.data.content[0].text;
                        }

                        throw new Error('Invalid response format');
                    } catch (error) {
                        console.warn('API è°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿå“åº”:', error);
                        return this.getMockResponse(message);
                    }
                },

                // è·å–æ¨¡æ‹Ÿå“åº”
                getMockResponse(message) {
                    const responses = [
                        'è¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿå“åº”ã€‚è¦è·å¾—çœŸå®çš„ Claude å“åº”ï¼Œè¯·é…ç½®æœ‰æ•ˆçš„ API Keyã€‚',
                        'æˆ‘ç†è§£ä½ çš„é—®é¢˜ã€‚ä½œä¸ºæ¼”ç¤ºç‰ˆæœ¬ï¼Œæˆ‘æä¾›é¢„è®¾çš„å›å¤ã€‚',
                        'å¾ˆå¥½çš„é—®é¢˜ï¼åœ¨å®é™…ä½¿ç”¨ä¸­ï¼ŒClaude ä¼šæä¾›æ›´è¯¦ç»†å’Œä¸ªæ€§åŒ–çš„å›ç­”ã€‚',
                        'æ„Ÿè°¢ä½ çš„æé—®ã€‚è¿™ä¸ªå†å²è®°å½•åŠŸèƒ½å¯ä»¥ä¿å­˜æ‰€æœ‰çš„å¯¹è¯è®°å½•ã€‚'
                    ];
                    return responses[Math.floor(Math.random() * responses.length)] + '\n\nä½ è¯´çš„æ˜¯ï¼š"' + message + '"';
                }
            },
            mounted() {
                console.log('Vue + Claude å†å²è®°å½•ç‰ˆå·²æŒ‚è½½!');

                // åŠ è½½ API Key
                const savedKey = localStorage.getItem(API_KEY_STORAGE);
                if (savedKey) {
                    this.apiKey = savedKey;
                }

                // åŠ è½½å†å²è®°å½•
                this.loadFromStorage();

                // åˆ›å»ºåˆå§‹ä¼šè¯
                this.createNewSession();

                // æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
                this.conversation.push({
                    role: 'assistant',
                    content: 'æ¬¢è¿ä½¿ç”¨å¢å¼ºç‰ˆ Claude æ’ä»¶ï¼ç°åœ¨æ”¯æŒå®Œæ•´çš„å†å²è®°å½•åŠŸèƒ½ï¼š\n\nâœ… ä¿å­˜æ‰€æœ‰å¯¹è¯å†å²\nâœ… æœç´¢å†å²è®°å½•\nâœ… å¯¼å…¥/å¯¼å‡ºå¯¹è¯\nâœ… å¤šä¼šè¯ç®¡ç†\nâœ… ä¼šè¯é‡å‘½å\n\nä½ å¯ä»¥åœ¨å·¦ä¾§æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰å†å²å¯¹è¯ã€‚',
                    timestamp: Date.now()
                });
            }
        }).mount('#app');
    </script>
</body>
</html>